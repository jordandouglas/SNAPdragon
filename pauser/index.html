
<!--
    --------------------------------------------------------------------
    --------------------------------------------------------------------
    This file is part of SimPol.

    SimPol is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    SimPol is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with SimPol.  If not, see <http://www.gnu.org/licenses/>. 
    --------------------------------------------------------------------
    --------------------------------------------------------------------
-->




<html>
<head>
<title>Pauser</title>
<link rel="icon" href="../src/Images/pauser.png">
<meta name="viewport" content="width=device-width, initial-scale=0.41, maximum-scale=1" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../src/Resources/styles.css">
<script language='JavaScript' type='text/JavaScript' src="../src/Resources/mersenne-twister.js"></script>
<script language='JavaScript' type='text/JavaScript' src="../src/Resources/jsPhyloSVG/raphael-min.js"></script>
<script language='JavaScript' type='text/JavaScript' src="../src/Resources/jsPhyloSVG/jsphylosvg-min.js"></script>
<script language='JavaScript' type='text/JavaScript' src="../src/Resources/jquery-3.1.1.min.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/interactiveHelp.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/Alignment.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/PhyloPause.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/Session.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/NBC.js"></script>
<script language='JavaScript' type='text/JavaScript' src="src/Controller/WebWorkerMessager.js"></script>
<script language='JavaScript' type="text/javascript" src ="../src/Resources/canvas-toBlob.js"></script>
<script language='JavaScript' type="text/javascript" src="../src/Resources/filesaver.js"></script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106202043-1', 'auto');
  ga('send', 'pageview');

</script>


<script language='JavaScript' type='text/JavaScript'>


function init(){

    PP_simulating = false;
    mersenneTwister = new MersenneTwister();
    WEB_WORKER_WASM = null;
    USE_WASM = true;
    
    IS_MOBILE = false; 
	IS_MOBILE = (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
   			 || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)));
    
    if (IS_MOBILE) $("#progressSimCanvas").attr("height", "60px");

	$(".uploadAlignmentFirst").hide(0);
	$(".beforeUploadingAlignment").show(0);


    var toDoAfterWWRegistration = function(){

        console.log("WASM registered")

        // Upload the default session file
        loadSessionFromURL("pauser.xml");
        
            
        // Set the thresholds to their initial value
        getThresholds_controller();
        
            
            
        // Load NBC file from default specifications
        var nbcURL = "http://www.polymerase.nz/pauser/NBC_pauser.csv";
        uploadNBCFromURL(nbcURL, function(){
            
              
            if (location.href.indexOf("?") != -1){
                
                var search = location.search.substring(1);
                var JSONurl = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}')
                
        
                if (JSONurl.biophys != null) {
                    begin_tutorial("biophys" + JSONurl.biophys);
                }
                
                
                 if (JSONurl.ex != null) {
                    begin_tutorial("ex" + JSONurl.ex);
                }

                
            }

            
            
        });
        
      
            
            
    }


    var registerWW = () => new Promise((resolve) => register_WebWorker(resolve));
    registerWW().then(() => toDoAfterWWRegistration());




            

}








function minimiseSection(element, setTo = null){

	var toHide = $(element).attr("id");
	var currentlyShown = $(element).val() == "+";
	toHide = toHide.substring(0, toHide.length-3); // Remove 'Btn' from the end
	console.log(toHide, currentlyShown);

	
	if(setTo == false || (setTo == null && !currentlyShown)){
		$(element).val("+");
		$("#" + toHide).hide(setTo == null ? 300 : 0);
	}
	else{
		$(element).val("-");
		$("#" + toHide).show(setTo == null ? 300 : 0);
	}

}


function log(num, base = null){
    
    if (num == 0) return 0;
    if (base == null) return Math.log(Math.abs(num));
    return Math.log(Math.abs(num)) / Math.log(base);
    
    
}




// Compute 10^n without using Math.pow which presents numerical instabilities
function tenToThePowerOf(n){


	if (n == 0) return 0;
	var val = "1";
	if (n < 0) {
		for (var i = -1; i > n; i --){
			val = "0" + val;
		}
		val = "." + val;
	}

	else if (n > 0) {
		for (var i = 0; i < n; i ++){
			val = val + "0";
		}

	}
	else {
		return 0;
	}
	//console.log(n, "->", parseFloat(val));
	return parseFloat(val);


}




function getLoaderTemplate(id, msg = ""){
	return `
		<table  id="` + id + `" title="Loading...">
			<tr>
				<td>
					<div class="loader pauser"></div> 
				</td>
				<td>
					` + msg + `
				</td>
			</tr>
		</table>
	`;
}



</script>

</head>

<body onload="init()">
	<div id="screenContainer" style="position:relative">
		<div id="screen" style="opacity:1;">


				

			<div id="main" style="background-color:white">
				
				
				<div id="header" class="header" style="width:100%; ">
					<table style="margin: 0px auto; width:100%">
						

						
						<tr>
							<td style="height:30px; width: 30%; vertical-align:bottom; ">
								
								
							</td>






                        	 <td  style="text-align:center; font-size: 20px; vertical-align:top; width: 40%;"> 
                                <div style="text-align:center;">

                                        <a href="" target="_blank" style="text-decoration:none;  color:#414b4b" title="Launch Pauser">
                                            <span class="title" style="font-size: 108px; line-height:0.8em "> Pauser </span><br>
                                            <span style="font-size: 18px; "> Predictor of Transcriptional Pause Sites </span>
                                        </a>
                                    
                                    
                                </div>
                                        
                            </td>
                            
            
                            
                            

                            <td style="width: 30%; vertical-align:bottom; text-align:right;"> 



                              	<a href="../"  target="_blank" style="text-decoration:none; color:white;">
                                    <span class="button extraline pauser" title="Go back home">Home</span> 
                              	</a>
                              
                              	<span class="button selected extraline pauser" title="Launch Pauser">Pauser</span> 
                             
                            	<a href="about/"  target="_blank" style="text-decoration:none; color:white;">
                                    <span class="button extraline pauser" title="Introductory tutorials and other information about Pauser">About</span>
                                </a>    
                         
                                    
                            </td>


                                



						</tr>

						
					</table>
				</div>



				<br><br>



			<div  class="panelOuter" style=" margin-left:50px; margin-right:50px">
				<div class="panelInner">

					<span class="noselect"  style="font-size:18px; ">
						<input type=button id='importSettingsBtn' class='minimise pauser' value='-' onClick="minimiseSection(this)">
						<b style="color:#0B522D">Import files</b>
						&nbsp;&nbsp;&nbsp;


						<div id="importSettings" style="padding: 20 10">
							<br>
							<div  id="uploadAlignmentDIV"  style="background-color:white; padding: 20 10; border-style:solid; border-color:#0B522D">


								<div style="font-size:20px; vertical-align:middle"> 1. Upload a nucleotide sequence(s) 
                                        <a href="about/#Uploading_nucleotide_sequences" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
									<span class="uploadAlignmentFirst greenTick" style="display:none" title="Successful upload"> &#10004; </span>
                         
									<input type=button id='uploadAlignmentBtn' onClick=uploadAlignment() value='Select file' title=".fasta" class="button pauser" style="z-index: 100; float:right;"> 
									<input style="display:none" type="file" id="uploadAlignment" accept=".fasta"> 

								<br><br></div>


						 		<div style="display:none" class="uploadAlignmentFirst"> Sequence(s) successfully uploaded. </div>

						 		<div class="beforeUploadingAlignment"> Upload one or more nucleotide sequences in .fasta format. Optionally include the locations of pause sites.
                                          </div>


							</div>

							
							<br>
							<div id="uploadSessionDIV" class="uploadAlignmentFirst" style="display:none; background-color:white; padding: 20 10; border-style:solid; border-color:#0B522D">

								
								<div style="font-size:20px"> 2. Upload a SimPol session file (optional) 
									<span class="uploadSessionFirst greenTick" style="display:none" title="Successful upload"> &#10004; </span>
                                         <a href="about/#Uploading_a_SimPol_session" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
                                
                                    <input type=button id='uploadSessionBtn' onClick=uploadSession() value='Select file' title=".xml" class="button pauser" style="z-index: 100; float:right;"> 
                                    <input style="display:none" type="file" id="uploadSession" accept=".xml"> 

                                <br><br></div>

								<div class="beforeUploadingSession">
                                      Upload a SimPol session file containing all the model and parameter settings to use for pause site prediction in .xml format.
                                </div>   

                                <div style="display:none" class="uploadSessionFirst">
                                      SimPol session successfully uploaded.
                                </div>   


							</div>



						</div>

					</span>
					

					</div>
				</div>

                    




			<br><br>

			<div  class="panelOuter" style=" margin-left:50px; margin-right:50px">
				<div class="panelInner">

					<span class="noselect"  style="font-size:18px; ">
						<input type=button id='conservationSectionBtn' class='minimise pauser' value='-' onClick="minimiseSection(this)">
						<b style="color:#0B522D">Prediction of transcriptional pause sites </b>
						&nbsp;&nbsp;&nbsp;
                         <span class="finishPauserFirst" style="display:none; cursor:pointer;" onclick="downloadClassifications();" title="Download the full pause site prediction results."> <img src="../src/Images/downloadGreen.png" style="vertical-align:middle; padding:5 0; width:30px;"> </span>
                                
                         <input class="uploadAlignmentFirst button pauser" type=button id='beginPauser' onClick="beginPauser(false);" value=" Begin Pauser" title="Predict the locations of pause sites in each sequence." style="z-index: 100; float:right; display:none"> 

                         <br><br>
						<div id="conservationSection" style="padding: 20 20">


                                <div style="display:none" class="uploadAlignmentFirst"> 
                                    When you are ready to start the transcription simulations press Begin. This will be executed client-side (ie. using your CPU) and may take a while to finish.
                                </div>



                                <div class="beginPauserFirst" style="display:none; color:#808D82"> 


                                    <table>
                                            <tr>
                                                  <td style="width:200px">
                                                     <div style="position:relative; width:220px">
                                                        <canvas id="progressSimCanvas" style="z-index:1; position:absolute; left:0; border-style:solid; border-colour:black" width="200px" height="30px"></canvas>
                                                        <span id="progressSimSpan" style="font-size: 20px; cursor:auto; z-index:2; color:black; text-align:center; position:absolute; left:0; top:6; width:100%"></span> 
                                                    </div>
                                                 </td>

                                                <td>
                                                       <br><br>
                                                    <span id="nTrialsComplete">0</span> out of <span id="nTrialsTotal">0</span> SimPol simulations have been completed for <span id="currentSequenceProgress">the current sequence</span>. <br>
                                                    <span id="nSequencesComplete">0</span> out of <span id="nSequencesTotal">0</span> sequences are complete. <br>
                                                </td>
                                  
                                        </tr>

                                    </table>
                                        
                                </div>
                               


                                <div class="beforeUploadingAlignment"> 
                                    Upload a nucleotide sequence(s) first.
                                </div>
                                
                                    
                                    
                        
                        <div class="uploadAlignmentFirst"  style="display:none">
                                
                                        
                                        
                                        
                             <div style="margin:20px; margin-bottom:50px">
                                 
                                <b style="color:#0B522D">Classifiers</b> 
                                <a href="about/#Classifiers" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
                                
                                <table id="classifiersTable" style="margin:10px; text-align:center" cellpadding=0 cellspacing=0> 
                                
                                    <tr style="color:#0B522D">
                                        <td style="min-width:100px;"  title="The method used to classify pause sites.">
                                             Classifier
                                        </td>
                                                    
                                                              
                                        <td style="width:100px;" title="The colour of a site which has been classified as a pause site by this method.">
                                             Positive
                                        </td>
                                                
                                                
                                        <td style="width:300px;" title="Adjust the threshold to select which sites are classified as pause sites.">
                                             Evidence threshold
                                        </td>
                                                    
                                                    
                                        <td style="width:300px">
                                        </td>
                                                    
                                                    
                                            
                                    </tr>
                                                
                                                
                                                
                                     <tr>
                                        <td style="color:#0B522D">
                                             SimPol       
                                        </td>
                                              
                                                    
                                                            
                                        <td style="position:relative">
                                             <span class="dot simpol_class_dot" style="top:0.5em; left:45%"></span>
                                        </td>
                                                
                                        <td style="position:relative">
                                             <input type="range" min="0" max="1" step="0.01" value="0.8" style="width:100%" class="slider simpol_class" onchange="updateThreshold_controller('simpol')" id="simpol_threshold">
                                        </td>
                                                    
                                                    
                                        <td rowspan="2">
                                              Higher thresholds result in fewer sites classified as pause sites. 
                                        </td>
                                                
                                        
                                            
                                    </tr>
                                                
                                                
                                                
                                     <tr>
                                        <td style="color:#0B522D">
                                             Naive Bayes (NBC)       
                                        </td>
                                                    
                                         <td style="position:relative">
                                             <span class="dot NBC_class_dot" style="top:0.5em; left:45%"></span>
                                        </td>
                                                
                                        <td style="position:relative">
                                             <input type="range" min="0" max="1" step="0.01" value="0.2" style="width:100%" class="slider NBC_class" onchange="updateThreshold_controller('nbc')" id="nbc_threshold">
                                        </td>
                                                
                                                
                                            
                                    </tr>


                                </table>
                            </div>
                                        
                                        
                                        
                                        
                                

                                    
                            <div  id="conservationMSA_DIV"  class='scrollbar pauser' style='scrollbar-x-position: top; overflow-x: scroll; position:relative; width:100%;'>

    							
                                <br><br>
                             
                                   
                                        

    							<div style="display:none" id="alignmentLoading"></div>
                                
                                            
                                            
                                            
                                    
    							<table id="conservationMSA" style="font-size:20px; font-family: 'Courier New';" cellpadding=2 cellspacing=0> 



    							</table>
                                            
                                       
                            </div>
                                        
                                        
                                        
                             <div class="flex-image" style="text-align:top">
                             
                             
                         
                                     <div style="margin:20px; margin-bottom:50px">
                                                    
                                         
                                        <b style="color:#0B522D">Classifier adequacy</b> 
                                        <a href="about/#Evaluating_classifier_adequacy" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
                                               
                                                    
                                        <div id="classifierAdequacy_nodata" style="display:none">
                                             Specify the locations of pause sites in one or more sequences in the .fasta file to assess the classifier adequacies.      
                                                        
                                        </div>
                                                    
                                        <table id="classifierAdequacyTable" style="margin:10px; text-align:center; display:none" cellpadding=0 cellspacing=0> 
                                        
                                            <tr style="color:#0B522D">
                                                <td style="min-width:100px;" title="The accession of any sequences whose pause sites are known.">
                                                     Accession
                                                </td>
                                                        
                                                            
                                                <td style="min-width:100px;" title="The method used to generate classifications.">
                                                     Classifier
                                                </td>
                                                            
                                                                      
                                                <td style="width:100px;" title="Recall / sensitivity / true positive rate. The probability of a known pause site being classified as one under the current threshold.">
                                                     Recall
                                                </td>
                                                        
                                                        
                                                <td style="width:100px;" title="The probability of a site classified as a pause site actually being one under the current threshold.">
                                                     Precision
                                                </td>
                                                            
                                                            
                                                <td style="width:100px" title="The overall proportion of correct classifications under the current threshold.">
                                                     Accuracy
                                                </td>
                                                            
                                                    
                                            </tr>


                                        </table>
                                    </div>

	                            	
	                             
	                             
	                              	<div id="ROC_curve_cont" style="margin:20px; margin-bottom:50px; text-align:center">
	                                                        
	                                                        
	                                                 <b style="color:#0B522D">ROC curve</b> 
	                                                 <a href="about/#ROC_curve" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
	                                                 <span style="cursor:pointer;" onclick="downloadROC();" title="Download the plot (.png)."> <img src="../src/Images/downloadGreen.png" class="icon small"> </span>
	                                                 <br><br>
	                                                        
	                                                 <canvas id="ROC_curve_canvas" width="0" height="0"></canvas>      
	                                                        
	                                  </div>
                             
             
		                         
		                                        
		                                        
		                             <div style="margin:20px">
		                                 
		                                <b style="color:#0B522D">Pause site classification summary</b> 
		                                 <a href="about/#Classifiers" title="Help" class="help" target="_blank" style="font-size:10px; padding:3; cursor:pointer;"><img class="helpIcon" src="../src/Images/help.png"></a>
		                                  
		                                <table id="predictionSummaryTable" style="margin:10px; text-align:right" cellpadding=0 cellspacing=0> 
		                                
		                                    <tr style="color:#0B522D">
		                                        <td style="min-width:100px;">
		                                             Accession       
		                                        </td>
		                                                
		                                                
		                                        <td style="max-width:300px; width:300px;" title="The predicted locations of pause sites, as classified by SimPol.">
		                                             SimPol    
		                                        </td>
		                                                
		                                                
		                                        <td style="max-width:300px; width:300px;" title="The predicted locations of pause sites, as classified by the Naive Bayes classifier.">
		                                             NBC
		                                        </td>
		                                                
		                                            
		                                        <td style="max-width:300px; width:300px;" title="The known locations of pause sites. These are optionally specified when uploading the .fasta file.">
		                                             Known pause sites
		                                        </td>
		                                                
		                                    </tr>
		
		
		                                </table>
		                            </div>
		                                
                                    
                                </div>
                                    
                                        

                            </div>


						</div>

					</span>
					

				</div>
			</div>






	
	
	
	
	<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
	<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> 

	<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
	<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> 




	
	
		<div class="header">
			Pauser | Centre for Computational Evolution & School of Biological Sciences, University of Auckland | 2019
		</div>
	


		</div>
	</div>


</div>
</body>
</html>
